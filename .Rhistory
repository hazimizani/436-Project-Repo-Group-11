fp <- getwd()
paste0(fp, '/Motor_Vehicle_Collisions_-_Crashes_20251017.csv')
knitr::opts_chunk$set(echo = FALSE)
library(tmap)
library(sf)
library(dplyr)
library(tidyr)
library(readr)
# borough_file_name <- "Borough_Boundaries_20251115.geojson"
#
# if (!file.exists(borough_file_name)) {
#   stop(paste("Error: The file", borough_file_name, "was not found in your working directory."))
# }
nyc_borough_sf <- st_read("../Datasets/Borough_Boundaries_20251115.geojson")
# csv_file_name <- 'Motor_Vehicle_Collisions_-_Crashes_20251114.csv'
#
#
# if (!file.exists(csv_file_name)) {
#   stop(paste("Error: The file", csv_file_name, "was not found in your working directory."))
# }
collisions_raw_df <- read_csv("../Datasets/Motor_Vehicle_Collisions_-_Crashes_20251017.csv")
collisions_df <- collisions_raw_df %>%
rename(
borough = BOROUGH,
number_of_pedestrians_injured = `NUMBER OF PEDESTRIANS INJURED`,
number_of_pedestrians_killed = `NUMBER OF PEDESTRIANS KILLED`,
number_of_cyclist_injured = `NUMBER OF CYCLIST INJURED`,
number_of_cyclist_killed = `NUMBER OF CYCLIST KILLED`,
number_of_motorist_injured = `NUMBER OF MOTORIST INJURED`,
number_of_motorist_killed = `NUMBER OF MOTORIST KILLED`
)
collisions_processed <- collisions_df %>%
mutate(across(
.cols = c(starts_with("number_of_")),
.fns = ~ as.numeric(tidyr::replace_na(., 0))
)) %>%
mutate(
motorist_casualties = number_of_motorist_injured + number_of_motorist_killed,
cyclist_casualties = number_of_cyclist_injured + number_of_cyclist_killed,
pedestrian_casualties = number_of_pedestrians_injured + number_of_pedestrians_killed
) %>%
mutate(borough = toupper(borough)) %>%
filter(
!is.na(borough) & borough != "",
(motorist_casualties + cyclist_casualties + pedestrian_casualties) > 0
)
borough_summary <- collisions_processed %>%
group_by(borough) %>%
summarise(
total_motorist = sum(motorist_casualties),
total_cyclist = sum(cyclist_casualties),
total_pedestrian = sum(pedestrian_casualties)
) %>%
mutate(
majority_casualty = case_when(
total_motorist >= total_cyclist & total_motorist >= total_pedestrian ~ "Motorist",
total_cyclist > total_motorist & total_cyclist >= total_pedestrian ~ "Cyclist",
total_pedestrian > total_motorist & total_pedestrian > total_cyclist ~ "Pedestrian",
TRUE ~ "Other" )
) %>%
mutate(majority_casualty = as.factor(majority_casualty))
map_data <- nyc_borough_sf %>%
mutate(borough_upper = toupper(boroname)) %>%
inner_join(borough_summary, by = c("borough_upper" = "borough"))
tmap_mode("view")
casualty_colors <- c(
"Motorist" = "#E41A1C",
"Cyclist" = "#377EB8",
"Pedestrian" = "#4DAF4A"
)
tm <- tm_shape(map_data) +
tm_polygons(
col = "majority_casualty",
title = "Majority Casualty Type",
palette = casualty_colors,
id = "boroname",
popup.vars = c(
"Borough" = "boroname",
"Majority" = "majority_casualty",
"Motorist Casualties" = "total_motorist",
"Cyclist Casualties" = "total_cyclist",
"Pedestrian Casualties" = "total_pedestrian"
),
border.col = "white",
border.alpha = 0.5
) +
tm_layout(
title = "NYC Majority Casualty Type by Borough",
title.position = c("left", "top"),
legend.position = c("right", "bottom")
) +
tm_basemap(server = "CartoDB.Positron")
print(tm)
# zip_geojson_file <- "Modified_Zip_Code_Tabulation_Areas_(MODZCTA)_20251115.geojson"
#
# if (!file.exists(zip_geojson_file)) {
#   stop(paste("Error: The file", zip_geojson_file, "was not found."))
# }
nyc_zip_sf <- st_read('Modified_Zip_Code_Tabulation_Areas_(MODZCTA)_20251115.geojson')
# zip_geojson_file <- "Modified_Zip_Code_Tabulation_Areas_(MODZCTA)_20251115.geojson"
#
# if (!file.exists(zip_geojson_file)) {
#   stop(paste("Error: The file", zip_geojson_file, "was not found."))
# }
nyc_zip_sf <- st_read('../Datasets/Modified_Zip_Code_Tabulation_Areas_(MODZCTA)_20251115.geojson')
# csv_file_name <- 'Motor_Vehicle_Collisions_-_Crashes_20251114.csv'
# if (!file.exists(csv_file_name)) {
#   stop(paste("Error: The file", csv_file_name, "was not found."))
# }
collisions_raw_df <- read_csv("../Datasets/Motor_Vehicle_Collisions_-_Crashes_20251017.csv")
collisions_df <- collisions_raw_df %>%
rename(
borough = BOROUGH,
zip_code = `ZIP CODE`,
number_of_pedestrians_injured = `NUMBER OF PEDESTRIANS INJURED`,
number_of_pedestrians_killed = `NUMBER OF PEDESTRIANS KILLED`,
number_of_cyclist_injured = `NUMBER OF CYCLIST INJURED`,
number_of_cyclist_killed = `NUMBER OF CYCLIST KILLED`,
number_of_motorist_injured = `NUMBER OF MOTORIST INJURED`,
number_of_motorist_killed = `NUMBER OF MOTORIST KILLED`
)
collisions_processed <- collisions_df %>%
mutate(across(
.cols = c(starts_with("number_of_")),
.fns = ~ as.numeric(tidyr::replace_na(., 0))
)) %>%
mutate(
motorist_casualties = number_of_motorist_injured + number_of_motorist_killed,
cyclist_casualties = number_of_cyclist_injured + number_of_cyclist_killed,
pedestrian_casualties = number_of_pedestrians_injured + number_of_pedestrians_killed
) %>%
filter(
!is.na(zip_code) & zip_code != "",
(motorist_casualties + cyclist_casualties + pedestrian_casualties) > 0
) %>%
mutate(zip_code = as.character(zip_code))
zip_summary <- collisions_processed %>%
group_by(zip_code) %>%
summarise(
total_motorist = sum(motorist_casualties),
total_cyclist = sum(cyclist_casualties),
total_pedestrian = sum(pedestrian_casualties)
) %>%
mutate(
majority_casualty = case_when(
total_motorist >= total_cyclist & total_motorist >= total_pedestrian ~ "Motorist",
total_cyclist > total_motorist & total_cyclist >= total_pedestrian ~ "Cyclist",
total_pedestrian > total_motorist & total_pedestrian > total_cyclist ~ "Pedestrian",
TRUE ~ "Other"
)
) %>%
mutate(majority_casualty = as.factor(majority_casualty))
map_data <- nyc_zip_sf %>%
mutate(modzcta_char = as.character(modzcta)) %>%
inner_join(zip_summary, by = c("modzcta_char" = "zip_code"))
tmap_mode("view")
casualty_colors <- c(
"Motorist" = "#E41A1C",
"Cyclist" = "#377EB8",
"Pedestrian" = "#4DAF4A"
)
tm <- tm_shape(map_data) +
tm_polygons(
col = "majority_casualty",
title = "Majority Casualty Type",
palette = casualty_colors,
id = "modzcta", # <-- FIX 2
popup.vars = c(
"Zip Code" = "modzcta", # <-- FIX 3
"Majority" = "majority_casualty",
"Motorist Casualties" = "total_motorist",
"Cyclist Casualties" = "total_cyclist",
"Pedestrian Casualties" = "total_pedestrian"
),
border.col = "white",
border.alpha = 0.5
) +
tm_layout(
title = "NYC Majority Casualty Type by Zip Code",
title.position = c("left", "top"),
legend.position = c("right", "bottom")
) +
tm_basemap(server = "CartoDB.Positron")
print(tm)
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, echo = TRUE, include = TRUE)
library(tidyverse)
library(tmap)
library(sf)
collisions = read_csv("../Datasets/Motor_Vehicle_Collisions_-_Crashes_20251017.csv")
names(collisions)
clean_collisions = collisions %>%
select(
LATITUDE,
LONGITUDE,
`CRASH DATE`,
`CRASH TIME`,
BOROUGH,
`NUMBER OF PERSONS INJURED`,
`NUMBER OF PERSONS KILLED`,
`CONTRIBUTING FACTOR VEHICLE 1`
) %>%
filter(
!is.na(LATITUDE),
!is.na(LONGITUDE),
between(LONGITUDE, -74.3, -73.6),
between(LATITUDE, 40.4, 40.95)
)
